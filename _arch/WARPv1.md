# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

# Digital Maturity Assessment (DMA) Tool

This is a client-side React application for assessing digital maturity of Small and Medium-sized Enterprises (SMEs) based on the EU/JRC Digital Maturity Assessment framework.

## Tech Stack

- **Framework**: Next.js 15 (App Router) + TypeScript
- **UI**: shadcn/ui + TailwindCSS
- **Charts**: Recharts (Radar charts)
- **State**: Zustand (client-side state management)
- **Validation**: Zod (runtime type validation)
- **i18n**: i18next + react-i18next (default: Norwegian)
- **Testing**: Jest + React Testing Library + Playwright
- **Export**: JSON (client-side, no backend)
- **Data privacy**: Client-only (no backend); results in-memory and optionally localStorage

## Quick Commands

```bash
# Install dependencies
npm install

# Run dev server
npm run dev

# Build for production
npm run build

# Run production server
npm run start

# Type-check
npm run typecheck

# Lint and format
npm run lint
npm run format

# Unit/integration tests
npm run test
npm run test:watch

# E2E tests (headed)
npm run test:e2e
```

## Common Development Commands

Add shadcn/ui components:
```bash
npx shadcn-ui@latest add button card input textarea checkbox radio-group select slider toggle-group dialog tabs alert toast
```

Update dependencies:
```bash
npm outdated
npm update
```

## Project Architecture

### Core Structure
- **Framework**: Next.js App Router; all assessment logic is client-side
- **Styling**: TailwindCSS with shadcn/ui components under `components/ui`
- **State**: Centralized in Zustand store: `src/store/assessment.ts`
- **Data**: Question config (Norwegian default): `src/data/questions.no.ts`
- **Scoring**: Pure functions in `src/lib/scoring.ts`
- **Classification**: Gap analysis in `src/lib/maturity.ts`
- **i18n**: i18next init `src/lib/i18n.ts`, locales in `locales/{no,en}/common.json`
- **UI flows**: Assessment form (wizard) → Results with radar chart → Export JSON

### Directory Structure

```
/app
  /layout.tsx               # Root layout with i18n provider
  /page.tsx                 # Landing page
  /assessment/page.tsx      # Questionnaire
  /results/page.tsx         # Results (radar, breakdown, export)
  
/components
  /assessment
    QuestionRenderer.tsx    # Main question component switcher
    CheckboxGroup.tsx       # Multi-select checkboxes
    DualCheckbox.tsx        # Two independent checkboxes
    LikertScale05.tsx       # 0-5 scale selector
    TriState.tsx           # Yes/Partial/No selector
    WizardNav.tsx          # Navigation between dimensions
  /charts
    RadarChart.tsx         # Recharts radar visualization
  /ui                      # shadcn autogenerated components

/src
  /data
    questions.no.ts        # Norwegian question specification
    questions.en.ts        # English question specification (future)
  /lib
    scoring.ts            # Core scoring algorithms
    maturity.ts           # Classification and gap analysis
    i18n.ts               # i18next initialization
    persistence.ts        # localStorage helpers
    utils.ts              # Utility functions
    export.ts             # JSON export functionality
  /store
    assessment.ts         # Zustand store
  /types
    assessment.ts         # Core type definitions

/locales
  /no/common.json          # Norwegian UI strings
  /en/common.json          # English UI strings

/docs                      # Project specifications
  spec.md                 # Technical specification
  ui_mapping.md           # UI/UX requirements
  complete_questionaire-norwegian.md  # Full Norwegian questions
```

## Assessment Framework

### 6 Dimensions
1. **Digital Business Strategy** (Q1-Q2)
2. **Digital Readiness** (Q3-Q4) 
3. **Human-Centric Digitalization** (Q5-Q6)
4. **Data Management and Connectivity** (Q7-Q8)
5. **Automation and Artificial Intelligence** (Q9)
6. **Green Digitalization** (Q10-Q11)

### Question Types
- **`checkboxes`**: Multi-select with weighted options
- **`dual-checkboxes`**: Two independent boolean checks (e.g., "Already invested" vs "Planning to invest")
- **`scale-0-5`**: Discrete 0–5 selection for technology adoption stages
- **`tri-state`**: Yes/Partial/No responses

### Scoring Algorithm

All question scores are normalized to 0..1:

- **checkboxes**: `(sum(weight of selected options)) / (sum(weight of all options))`
- **dual-checkboxes**: Combined weighted score of both checkboxes
- **scale-0-5**: `value / 5`
- **tri-state**: Yes=1, Partial=0.5, No=0

Dimension scores are weighted means of their questions (0-100 scale).
Overall score is weighted mean of dimension scores.

### Maturity Classification

- **0-25%**: Basic
- **26-50%**: Average  
- **51-75%**: Moderately Advanced
- **76-100%**: Advanced

## TypeScript Schema

```ts
export type QuestionType = 'checkboxes' | 'dual-checkboxes' | 'scale-0-5' | 'tri-state';

export interface AssessmentSpec {
  version: string;
  language: 'no' | 'en';
  dimensions: Dimension[];     // 6 dimensions
  questions: Question[];       // 11 questions
}

export interface Dimension {
  id: string;                  // e.g., 'strategy'
  name: string;                // localized key
  description?: string;        // localized key
  weight?: number;             // default 1
  targetLevel?: number;        // 0..1 default 1 (for gap analysis)
}
```

## Key Implementation Details

### Radar Chart Data Format
```ts
type RadarDatum = { dimension: string; score: number; target?: number };
```
Renders two overlaid series (current vs target scores).

### JSON Export Structure
```json
{
  "version": "1.0.0",
  "language": "no", 
  "timestamp": "2025-01-01T12:00:00.000Z",
  "answers": { "Q1": ["opt-a","opt-c"], "Q2": 4 },
  "scores": {
    "dimensions": [{"id":"strategy","score":0.62,"target":0.8,"gap":0.18}],
    "overall": 0.58,
    "classification": {"level": 3, "label": "Developing"}
  }
}
```

### Gap Analysis
- Each dimension can define `targetLevel` (0..1, default 1.0)
- Gap = targetLevel - actualScore (clamped to [0..1])
- Identifies areas needing improvement

## Internationalization

- **Default language**: Norwegian (`no`)
- **UI strings**: `locales/no/common.json` and `locales/en/common.json`
- **Question content**: Defined in `src/data/questions.no.ts` with localization keys
- **Language switching**: Persisted in localStorage

## Accessibility Requirements

- Keyboard navigation across all controls
- Proper ARIA labels and roles
- WCAG AA color contrast compliance
- Visible focus states (via Tailwind)
- Screen reader compatibility

## Testing Strategy

- **Unit tests**: Scoring algorithms, classification logic (Jest)
- **Component tests**: Question renderers, export functionality (RTL)
- **E2E tests**: Complete assessment flow (Playwright)
- **Coverage target**: ≥95% on scoring module

## Development Workflow

### Environment Requirements
- Node.js ≥18.18 (recommend 22+ LTS)
- npm package manager
- Git for version control

### Branching Strategy
- `feature/...` for new features
- `fix/...` for bug fixes  
- `chore/...` for maintenance
- `docs/...` for documentation

### Code Quality
- ESLint + Prettier for formatting
- Husky + lint-staged for pre-commit hooks
- Type checking with TypeScript strict mode

## shadcn/ui Setup

Initialize once:
```bash
npx shadcn-ui@latest init
```

Add components as needed. All UI components are stored under `components/ui` and are fully customizable.

## Updating Question Specifications

To modify the DMA questions:

1. Edit `src/data/questions.no.ts`
2. Keep `id` fields stable for compatibility
3. Update corresponding translation keys
4. Ensure scoring weights align with official DMA documentation
5. Test thoroughly with sample data

## Common Issues & Solutions

**shadcn import errors**: Re-run `npx shadcn-ui@latest init` and re-add missing components

**Chart not rendering**: Ensure component has `"use client"` directive and data is non-empty

**i18n not switching**: Verify i18next provider setup in layout.tsx and translation files are loaded

**Scoring discrepancies**: Validate against official DMA documentation and test with known answer sets

## Deployment

### Local Production Build
```bash
npm run build
npm run start
```

### Recommended Hosting
- **Vercel** (optimal for Next.js)
- **Netlify** (static export compatible)
- **Cloudflare Pages** (edge deployment)

The application is fully client-side with no backend dependencies, making it suitable for static hosting.

## Performance Targets

- Initial page load: <2s
- Scoring computation: <200ms  
- JSON export generation: <1s
- Mobile responsiveness: All breakpoints
- Accessibility: WCAG 2.2 AA compliance

## Maintenance

- Update dependencies monthly
- Run test suite after upgrades
- Monitor for new shadcn/ui components
- Keep DMA specification aligned with EU updates
- Translate UI for additional languages as needed

---

This WARP.md provides comprehensive guidance for developing, maintaining, and extending the Digital Maturity Assessment tool. The modular architecture supports easy customization while maintaining scoring accuracy and user experience quality.